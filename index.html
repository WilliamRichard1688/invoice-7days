<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MONEY EXPRESS CAMBODIA - 7-Day Daily Loan Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Define a professional bank color palette and consistent spacing */
        :root {
            --primary: #004D7A; /* A deep, professional navy blue */
            --primary-light: #0077B6;
            --secondary: #50C878; /* A complementary green for success */
            --dark: #1A232F; /* Very dark text for readability */
            --light: #F0F4F7; /* Lighter background for sections */
            --background: #FFFFFF; /* Overall page background */
            --border-color: #DDE1E6; /* Subtle borders */
            --text-muted: #5A6A78; /* Muted text for labels/hints */
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.12);
        }

        /* Base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            background-color: var(--background);
            color: var(--dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 20px var(--shadow-medium);
        }

        header {
            padding: 30px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            text-align: center;
            border-bottom: 5px solid var(--secondary);
            display: block;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }

        .calculator {
            padding: 30px;
            border-bottom: 1px solid var(--border-color);
        }

        .calculator:last-child {
            border-bottom: none;
        }

        h2 {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 28px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }

        h2 svg {
            width: 28px;
            height: 28px;
            stroke-width: 2;
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper input,
        .select-wrapper select {
            width: 100%;
            padding: 15px 18px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.05rem;
            transition: all 0.2s ease-in-out;
            background: white;
            color: var(--dark);
            font-family: 'Inter', sans-serif;
            box-shadow: inset 0 1px 3px var(--shadow-light);
            appearance: none; /* Remove default browser dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        .input-wrapper input:focus,
        .select-wrapper select:focus {
            outline: none;
            border-color: var(--primary);
            /* Removed glow */
            background-color: #fcfdff;
        }

        .input-wrapper .currency {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper::after {
            content: 'â–¼';
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.7rem; /* Slightly smaller arrow */
            pointer-events: none;
            transition: transform 0.2s ease-in-out;
        }

        .select-wrapper select:focus + .select-wrapper::after {
            transform: translateY(-50%) rotate(180deg); /* Rotate arrow on focus/open */
        }

        /* Buttons */
        button {
            padding: 16px 32px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            user-select: none;
            width: 100%;
            margin-top: 15px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px var(--shadow-light);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
        }

        .print-btn {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
            margin-top: 20px;
        }

        .print-btn:hover {
            background-color: var(--primary-light);
            color: white;
        }

        /* Results section */
        .results {
            margin-top: 30px;
            padding: 25px;
            background: var(--light);
            border-radius: 10px;
            box-shadow: inset 0 1px 5px var(--shadow-light);
            display: none;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 5px var(--shadow-light);
            text-align: center;
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .chart-container {
            margin-top: 25px;
            height: 250px;
            position: relative;
        }

        /* Receipt and Schedule Styles */
        .receipt-container {
            margin-top: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-medium);
            display: none;
        }

        .receipt-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary);
            font-weight: 700;
        }

        .receipt-content {
            white-space: pre-wrap;
            font-family: 'Inter', Arial, sans-serif;
            line-height: 1.9;
            padding: 25px;
            background: #FAFBFC;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
        }

        /* Table container for responsiveness */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 20px 0;
        }

        /* Table styling for schedules */
        .receipt-content table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin-top: 0;
            font-size: 0.9rem;
        }

        .receipt-content th,
        .receipt-content td {
            border: 1px solid #E0E0E0;
            padding: 10px 12px;
            text-align: left;
        }

        .receipt-content th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .receipt-content tr:nth-child(even) {
            background-color: #F8F8F8;
        }
        .receipt-content tr:hover {
            background-color: #EFEFEF;
        }

        .receipt-content td:last-child {
            font-weight: 500;
        }

        .receipt-signature {
            display: flex;
            justify-content: space-around;
            margin-top: 40px;
            text-align: center;
            font-size: 0.9rem;
        }

        .receipt-signature div {
            width: 45%;
        }

        .receipt-signature .line {
            border-top: 1px solid var(--dark);
            margin-top: 60px;
            margin-bottom: 10px;
        }


        .no-print {
            margin-bottom: 20px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }
            .calculator {
                padding: 20px;
            }
            h1 {
                font-size: 1.8rem;
            }
            h2 {
                font-size: 1.4rem;
                margin-bottom: 20px;
            }
            .result-grid {
                grid-template-columns: 1fr;
            }
            .receipt-container {
                padding: 20px;
                border-radius: 0;
                box-shadow: none;
            }
            .receipt-title {
                font-size: 1.4rem;
            }
            .receipt-content {
                padding: 15px;
                font-size: 0.88rem;
            }
            button {
                padding: 14px 20px;
                font-size: 15px;
            }
            .receipt-signature {
                flex-direction: column;
            }
            .receipt-signature div {
                width: 100%;
                margin-bottom: 30px;
            }
        }

        @media print {
            .no-print, button {
                display: none !important;
            }
            body {
                background: white;
                padding: 0;
                font-size: 10pt;
            }
            .container {
                box-shadow: none;
                border-radius: 0;
                margin: 0;
            }
            .calculator {
                padding: 10px;
                border-bottom: none;
            }
            .receipt-container {
                box-shadow: none;
                border: none;
                padding: 0;
                margin-top: 0;
                display: block !important;
            }
            .receipt-content {
                border: none;
                padding: 5px;
                font-size: 10pt;
                white-space: pre-wrap;
            }
            .results {
                display: none !important;
            }
            header {
                display: none !important;
            }
            /* Adjust table for print */
            .receipt-content table {
                font-size: 9pt;
                min-width: unset;
            }
            .receipt-content th, .receipt-content td {
                padding: 5px 8px;
            }
            .table-responsive {
                overflow-x: unset;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MONEY EXPRESS CAMBODIA</h1>
            <div class="subtitle">7-Day Daily Loan Calculator (Flat Fee Included)</div>
        </header>

        <div class="calculator">
            <h2>
                MONEY EXPRESS CAMBODIA
            </h2>

            <div class="no-print">
                <div class="form-group">
                    <label for="loanCustomerName">Customer Name</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanCustomerName" placeholder="KITH SEYHA" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanCustomerPhone">Customer Phone Number</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanCustomerPhone" placeholder="012 345 678" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanCustomerID">Customer ID Card Number</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanCustomerID" placeholder="12345678" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanAccountNumber">Account Number</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanAccountNumber" placeholder="12345678" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanBankName">Lending Institution Name</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanBankName" value="MONEY EXPRESS CAMBODIA" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanBankAddress">Lending Institution Address</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanBankAddress" value="National Road No. 1, Sangkat Niroth, Khan Chbar Ampov, Phnom Penh, 12357" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanBankPhone">Lending Institution Phone Number</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanBankPhone" value="089 202 808" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanAmount">Loan Principal Amount</label>
                    <div class="input-wrapper">
                        <input type="number" id="loanAmount" placeholder="110.00" oninput="calculateLoan(); generateLoanReceipt();">
                        <span class="currency">$</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanFeeRate">Flat Loan Fee Rate (as % of Principal)</label>
                    <div class="input-wrapper">
                        <input type="number" id="loanFeeRate" value="1.5" min="0" step="0.1" oninput="calculateLoan(); generateLoanReceipt();">
                        <span class="currency">%</span>
                    </div>
                </div>
                <input type="hidden" id="loanTerm" value="7">
                <input type="hidden" id="loanRate" value="0">
                <div class="form-group">
                    <label for="loanStartDate">Start Date (DD/MM/YYYY)</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanStartDate" placeholder="07/10/2025" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loanReceiptNumber">Receipt Number</label>
                    <div class="input-wrapper">
                        <input type="text" id="loanReceiptNumber" placeholder="LR-20251007-001" oninput="calculateLoan(); generateLoanReceipt();">
                    </div>
                </div>
            </div>

            <div class="results" id="loanResults">
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Approx. Daily Principal Payment</div>
                        <div class="result-value" id="monthlyPayment">$0.00</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Total Loan Fee/Interest</div>
                        <div class="result-value" id="totalInterest">$0.00</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Total Repayment (Principal + Fee)</div>
                        <div class="result-value" id="totalPayment">$0.00</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Loan Term</div>
                        <div class="result-value" id="interestRate">7 Days (Daily Payments)</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="loanChart"></canvas>
                </div>
            </div>

            <div id="loanReceipt" class="receipt-container">
                <div class="receipt-title">Loan Receipt (7-Day Daily Term)</div>
                <div id="loanReceiptContent" class="receipt-content"></div>
                <button class="print-btn" onclick="window.print()">Print Receipt</button>
            </div>

            <div id="loanSchedule" class="receipt-container" style="display: none;">
                <div class="receipt-title">Loan Payment Schedule (7-Day Daily Term)</div>
                <div id="loanScheduleContent" class="receipt-content"></div>
                <button class="print-btn" onclick="window.print()">Print Schedule</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize charts
        const loanChartCtx = document.getElementById('loanChart').getContext('2d');

        let loanChart = new Chart(loanChartCtx, {
            type: 'doughnut',
            data: {
                labels: ['Principal', 'Loan Fee'],
                datasets: [{
                    data: [100, 0],
                    backgroundColor: ['#004D7A', '#50C878'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: $${context.raw.toFixed(2)}`;
                            }
                        }
                    }
                }
            }
        });


        function calculateLoan() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const loanFeeRate = parseFloat(document.getElementById('loanFeeRate').value) / 100; // Get fee rate as a decimal
            const termDays = 7; // Fixed Term

            if (isNaN(amount) || amount <= 0) {
                document.getElementById('monthlyPayment').textContent = '$0.00';
                document.getElementById('totalInterest').textContent = '$0.00';
                document.getElementById('totalPayment').textContent = '$0.00';
                document.getElementById('interestRate').textContent = '7 Days (Daily Payments)';
                loanChart.data.datasets[0].data = [100, 0];
                loanChart.update();
                document.getElementById('loanResults').style.display = 'none';
                document.getElementById('loanReceipt').style.display = 'none';
                document.getElementById('loanSchedule').style.display = 'none';
                return;
            }

            // Calculation for 7-Day Daily Amortization (Principal Only Repayment)
            const dailyPrincipalPayment = Math.floor((amount / termDays) * 100) / 100; // e.g., $15.71 for principal portion

            // Calculate the flat loan fee
            const loanFee = amount * loanFeeRate; 
            const totalRepayment = amount + loanFee; // Total repayment is Principal + Fee

            // The 'monthlyPayment' result item will now show the approximate daily principal payment.
            document.getElementById('monthlyPayment').textContent = '$' + dailyPrincipalPayment.toFixed(2);
            document.getElementById('totalInterest').textContent = '$' + loanFee.toFixed(2);
            document.getElementById('totalPayment').textContent = '$' + totalRepayment.toFixed(2);
            document.getElementById('interestRate').textContent = termDays + ' Days (Daily Payments)';

            // Chart data
            loanChart.data.datasets[0].data = [amount, loanFee];
            loanChart.data.labels = ['Principal', 'Loan Fee'];
            loanChart.update();

            document.getElementById('loanResults').style.display = 'block';
            generateLoanSchedule();
        }


        function generateLoanReceipt() {
            const name = document.getElementById('loanCustomerName').value;
            const phone = document.getElementById('loanCustomerPhone').value;
            const idCard = document.getElementById('loanCustomerID').value;
            const acc = document.getElementById('loanAccountNumber').value;
            const bank = document.getElementById('loanBankName').value;
            const bankAddress = document.getElementById('loanBankAddress').value;
            const bankPhone = document.getElementById('loanBankPhone').value;
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const loanFeeRate = parseFloat(document.getElementById('loanFeeRate').value); // Get fee rate as a percentage
            const termDays = 7; // Fixed term
            const start = document.getElementById('loanStartDate').value;
            const receiptNo = document.getElementById('loanReceiptNumber').value;

            calculateLoan();

            const dailyPrincipalPayment = document.getElementById('monthlyPayment').textContent; // Approx. Daily Principal Payment
            const loanFee = document.getElementById('totalInterest').textContent; // Total Loan Fee/Interest
            const totalRepayment = document.getElementById('totalPayment').textContent;

            let formattedEndDate = '';
            if (start) {
                const [day, month, year] = start.split('/').map(Number);
                const endDate = new Date(year, month - 1, day);
                // Calculate end date by adding 7 days
                endDate.setDate(endDate.getDate() + termDays);
                formattedEndDate = `${String(endDate.getDate()).padStart(2, '0')}/${String(endDate.getMonth() + 1).padStart(2, '0')}/${endDate.getFullYear()}`;
            }

            const receiptText = `
Loan Receipt (7-Day Daily Repayment)

Receipt No: ${receiptNo || 'N/A'}
Issue Date: ${new Date().toLocaleDateString('en-US', { day: '2-digit', month: '2-digit', year: 'numeric' })}

Customer Information:
Customer Name: ${name || 'N/A'}
Phone Number: ${phone || 'N/A'}
ID Card Number: ${idCard || 'N/A'}
Account Number: ${acc || 'N/A'}

Lending Institution Information:
Lending Institution Name: ${bank || 'N/A'}
Address: ${bankAddress || 'N/A'}
Phone Number: ${bankPhone || 'N/A'}

Loan Details:
Loan Principal Amount: $${isNaN(amount) ? '0.00' : amount.toFixed(2)} USD
Loan Fee/Interest Rate: ${isNaN(loanFeeRate) ? '0.00' : loanFeeRate.toFixed(2)}% Flat Fee (Applied to Principal)
Term: ${termDays} days (Daily Payments)
Start Date: ${start || 'N/A'}
End Date (Final Payment Date): ${formattedEndDate || 'N/A'}

Calculation Results:
Approx. Daily Principal Payment: ${dailyPrincipalPayment}
Total Loan Fee/Interest: ${loanFee}
Total Repayment (Principal + Fee): ${totalRepayment}

Terms and Conditions:
1. The full principal amount is repaid over 7 daily payments.
2. The flat loan fee of ${loanFee} is included in the Total Repayment amount and is collected with the first daily payment.
3. Payments should be made each day on or before the dates listed in the schedule.
4. Keep this receipt as proof of the agreed repayment schedule.

Signature:

--------------------
(${name || ' '})
Customer

--------------------
(Recipient)
            `;

            document.getElementById('loanReceiptContent').innerText = receiptText;
            if (!isNaN(amount) && amount > 0) {
                document.getElementById('loanReceipt').style.display = 'block';
                document.getElementById('loanSchedule').style.display = 'block';
            } else {
                document.getElementById('loanReceipt').style.display = 'none';
                document.getElementById('loanSchedule').style.display = 'none';
            }
        }


        function generateLoanSchedule() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const startDateStr = document.getElementById('loanStartDate').value;
            const termDays = 7;
            const loanFeeRate = parseFloat(document.getElementById('loanFeeRate').value) / 100; // Get fee rate as a decimal
            const loanFee = amount * loanFeeRate;
            const totalRepayment = amount + loanFee;


            if (isNaN(amount) || amount <= 0 || !startDateStr) {
                document.getElementById('loanScheduleContent').innerHTML = "<div class='table-responsive'>Please enter a valid Loan Principal Amount (Amount > 0) to generate the schedule.</div>";
                document.getElementById('loanSchedule').style.display = 'none';
                return;
            }

            // Calculation for daily principal payment 
            const equalPrincipalPayment = Math.floor((amount / termDays) * 100) / 100;
            const finalPrincipalPayment = amount - (equalPrincipalPayment * (termDays - 1));
            let cumulativePrincipalPaid = 0;

            let scheduleHTML = `
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Day</th>
                                <th>Payment Date</th>
                                <th>Beginning Principal Balance</th>
                                <th>Principal Payment</th>
                                <th>Fee Paid</th>
                                <th>Total Payment (USD)</th>
                                <th>Remaining Principal Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

            const [startDay, startMonth, startYear] = startDateStr.split('/').map(Number);
            let currentDate = new Date(startYear, startMonth - 1, startDay);
            let outstandingPrincipalBalance = amount;

            // Assuming the flat fee is due on the first payment day (Day 1) along with the first principal payment.

            for (let i = 1; i <= termDays; i++) {
                const paymentDate = new Date(currentDate);
                // For daily payment, the payment date is the current date (Day 1) or the current date + 1 day (Day 2, 3, etc.)
                if (i > 1) {
                    paymentDate.setDate(paymentDate.getDate() + 1);
                }
                currentDate = new Date(paymentDate);


                const principalPayment = i < termDays ? equalPrincipalPayment : finalPrincipalPayment;
                const feePayment = i === 1 ? loanFee : 0; // Fee is paid entirely on Day 1
                const totalPaymentEntry = principalPayment + feePayment;
                const beginningBalance = outstandingPrincipalBalance;

                outstandingPrincipalBalance -= principalPayment;
                cumulativePrincipalPaid += principalPayment;

                // Ensure the last payment zeroes out the balance perfectly
                if (i === termDays) {
                    outstandingPrincipalBalance = 0;
                }

                scheduleHTML += `
                    <tr>
                        <td>Day ${i}</td>
                        <td>${paymentDate.toLocaleDateString('en-US', { day: '2-digit', month: '2-digit', year: 'numeric' })}</td>
                        <td>$${beginningBalance.toFixed(2)}</td>
                        <td>$${principalPayment.toFixed(2)}</td>
                        <td>$${feePayment.toFixed(2)}</td>
                        <td>$${totalPaymentEntry.toFixed(2)}</td>
                        <td>$${Math.max(0, outstandingPrincipalBalance).toFixed(2)}</td>
                    </tr>
                `;
            }

            scheduleHTML += `
                <tr>
                    <td colspan="3" style="text-align:right; font-weight:700;">Totals:</td>
                    <td style="font-weight:700;">$${amount.toFixed(2)}</td>
                    <td style="font-weight:700;">$${loanFee.toFixed(2)}</td>
                    <td style="font-weight:700;">$${totalRepayment.toFixed(2)}</td>
                    <td></td>
                </tr>
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('loanScheduleContent').innerHTML = scheduleHTML;
            document.getElementById('loanSchedule').style.display = 'block';
        }

        // Initial calculations and receipt/schedule generation when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const formattedToday = `${day}/${month}/${year}`;

            if (!document.getElementById('loanStartDate').value) {
                document.getElementById('loanStartDate').value = formattedToday;
            }

            // Set a default value to trigger initial calculation and show structure
            if (!document.getElementById('loanAmount').value) {
                document.getElementById('loanAmount').value = '100.00';
            }

            calculateLoan();
            generateLoanReceipt();
        });
    </script>
</body>
</html>